{% extends "index.html" %}

{% block content %}
	<svg width="960" height="960" font-family="sans-serif" font-size="10" text-anchor="middle"></svg>
	<script src="https://d3js.org/d3.v3.min.js"></script>
	<script>

		var svg = d3.select("svg"),
		    width = +svg.attr("width"),
		    height = +svg.attr("height");

		var pack = d3.layout.pack()
		    .size([width-20, height-20])
		    .padding(4);

		d3.json("/static/load.json", function(json_data){

			console.log(json_data);
			parsed_data = json_data["results"];
			parsed_data.forEach(function(d) {

				d.name = Object.keys(d)[0];
				d.value = d[Object.keys(d)[0]].length;
			})

		/*var root = d3.layout.hierarchy({children: data})
    	.sum(function(d) { return d.value; })*/

    	var root = {
    		name: 'root',
    		value: 1,
    		children: parsed_data
    	}

    	pack_nodes = pack(root);

    	console.log(root);
    	console.log(pack_nodes);

		var node = svg.selectAll(".group")
		.data(pack_nodes)
		.enter().append("g")
		  .attr("class", "group")
		  .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });		

		node.append("circle")
		  .attr("id", function(d) { return d.id; })
		  .attr("r", function(d) { return d.r; })
		  .style("fill", "rgba(31, 119, 180, 0)")
		  .style("stroke", "black")
		  .on("click", function(d) {		
		  	appendFilter(d.id, d.name);
		  });

		node.append("text")
			.text(function(d) {
		  	
			return d.name;
		});

		var root_node = d3.select('.group')
		  .style("fill", "rgba(31, 119, 180, 0)")
		  .style("stroke", "rgba(31, 119, 180, 0.29)")			
		});

	</script>
{% endblock %}